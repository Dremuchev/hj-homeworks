<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Задача 3. Аудиоплеер | Домашнее задание к лекции 1.2</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="mediaplayer">
  	<audio src="https://d34x6xks9kc6p2.cloudfront.net/540997b0-a35f-4b69-86d6-b1c925c4a264/540997b0-a35f-4b69-86d6-b1c925c4a264.mp3"></audio>
  	<div class="discarea">
  		<div class="disc">
  		</div>
  		<div class="stylus">
  			<div class="pivot"></div>
  			<div class="arm"></div>
  			<div class="head"></div>
  		</div>
  	</div>
  	<div class="controls">
  		<span class="title" title="LA Chill Tour"></span>
  		<div class="buttons">
  			<button class="back">
  				<i class="fa fa-backward"></i>
  			</button>
  			<button class="playstate">
  				<i class="fa fa-play"></i>
  				<i class="fa fa-pause"></i>
  			</button>
  			<button class="stop">
  				<i class="fa fa-stop"></i>
  			</button>
  			<button class="next">
  				<i class="fa fa-forward"></i>
  			</button>
  		</div>
  	</div>
  </div>
  <script>
	  const playlist = {
          'LA Chill Tour': "https://netology-code.github.io/hj-homeworks/html-element-collection/audioplayer/mp3/LA Chill Tour.mp3",
          'This is it band': "https://netology-code.github.io/hj-homeworks/html-element-collection/audioplayer/mp3/This is it band.mp3",
          'LA Fusion Jam': "https://netology-code.github.io/hj-homeworks/html-element-collection/audioplayer/mp3/LA Fusion Jam.mp3"
	  }
	  const titleArray = [];
	  const srcArray = [];
	  for(key in playlist) {
	      titleArray.push(key);
	      srcArray.push(playlist[key]);
	  }
	  const songTitle = document.getElementsByClassName('title');
	  const btnPlay = document.getElementsByClassName('playstate');
	  const btnPlayState = document.getElementsByClassName('mediaplayer');
	  const btnStop = document.getElementsByClassName('stop');
	  const btnNext = document.getElementsByClassName('next');
	  const btnBack = document.getElementsByClassName('back');
	  const player = document.getElementsByTagName('audio');
	  var timerId;
	  btnPlay[0].onclick = () => {
          btnPlayState[0].classList.toggle('play');
		  if(isPlaying()) {
			  player[0].play();
			  timerId = setInterval(() => {
			      if(player[0].ended) {
			          stop();
				  }
			  }, 2000)
		  } else {
		      clearInterval(timerId);
              player[0].pause();
		  }
	  }
	  function stop() {
	      clearInterval(timerId);
          player[0].pause();
          player[0].currentTime = 0;
          if(isPlaying()) {
              btnPlayState[0].classList.toggle('play');
          }
	  }
	  btnStop[0].onclick = stop;
	  function isPlaying() {
          if(btnPlayState[0].classList.contains('play')) {
              return true;
		  } else return false;
	  }
	  var step = 0;
	  btnNext[0].onclick = () => {
	      step += 1;
	      if(step === titleArray.length) {
	          step = 0;
		  }
		  songTitle[0].title = titleArray[step];
		  player[0].src = srcArray[step];
		  if(isPlaying()) {
		      player[0].play();
		  }
	  }
      btnBack[0].onclick = () => {
		  if(step === 0) {
              step = titleArray.length - 1;
              songTitle[0].title = titleArray[step];
              player[0].src = srcArray[step];
		  } else {
              step -= 1;
              songTitle[0].title = titleArray[step];
              player[0].src = srcArray[step];
		  }
          if(isPlaying()) {
              player[0].play();
          }
	  }

  </script>
</body>
</html>
